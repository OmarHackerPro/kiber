// Prisma schema: User, Preferences, Content
// Database URL is read from .env (DATABASE_URL)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ---------------------------------------------------------------------------
// User model: id (UUID), name, email (unique), hashed password, role, timestamps
// ---------------------------------------------------------------------------
model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String   // stored hashed (bcrypt)
  role      String   @default("USER") // USER | ADMIN (SQLite has no enums)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  preferences UserPreferences?
  contents    Content[]
}

// ---------------------------------------------------------------------------
// User preferences: theme, notifications, language, extensible JSON settings
// ---------------------------------------------------------------------------
model UserPreferences {
  id             String   @id @default(uuid())
  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  theme          String   @default("system") // "light" | "dark" | "system"
  notifications  Boolean  @default(true)
  language       String   @default("en")
  // Extensible settings (e.g. timezone, font size) stored as JSON
  settings       String?  // JSON string for extra key-value pairs
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

// ---------------------------------------------------------------------------
// Content: title, body, author (relation), status, tags, metadata (JSON)
// ---------------------------------------------------------------------------
model Content {
  id        String   @id @default(uuid())
  title     String
  body      String
  authorId  String
  author    User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  status    String   @default("DRAFT") // DRAFT | PUBLISHED (SQLite has no enums)
  tags      String   // JSON array string for SQLite
  metadata  String?  // JSON string for flexible key-value metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
